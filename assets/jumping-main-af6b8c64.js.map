{"version":3,"file":"jumping-main-af6b8c64.js","sources":["../../src/jumping-main.ts"],"sourcesContent":["/// <reference types=\"@workadventure/iframe-api-typings\" />\n/// <reference types=\"vite/client\" />\nimport { bootstrapExtra } from \"@workadventure/scripting-api-extra\";\nimport { subscribeToLLMAreas } from \"./features/llm-areas/llm-areas\";\nimport { levelUp } from \"@workadventure/quests\";\nimport { checkPlayerMaterial, mySound, playRandomSound } from \"./footstep\";\n\nWA.onInit().then(() => {\n  var lavaSFX = WA.sound.loadSound(\"./public/lava-cave.wav\");\nvar config = {\n    volume : 0.5,\n    loop : true,\n    rate : 1,\n    detune : 1,\n    delay : 0,\n    seek : 0,\n    mute : false\n}\nlavaSFX.play(config);\n})\n\nconsole.log(\"Script started successfully\");\n\n// Waiting for the API to be ready\nWA.onInit()\n  .then(() => {\n    console.log(\"Scripting API ready\");\n    console.log(\"Player tags: \", WA.player.tags);\n\n    subscribeToLLMAreas();\n\n    // The line below bootstraps the Scripting API Extra library that adds a number of advanced properties/features to WorkAdventure\n    bootstrapExtra()\n      .then(() => {\n        console.log(\"Scripting API Extra ready\");\n      })\n      .catch((e) => console.error(e));\n  })\n  .catch((e) => console.error(e));\n\n  WA.onInit().then(async () => {\n    WA.player.onPlayerMove(async ({ x, y, moving }) => {\n      const material = await checkPlayerMaterial({ x, y });\n      console.log(material);\n  \n      if (!material) {\n        return mySound?.stop();\n      }\n  \n      if (!moving && !material) {\n        return mySound?.stop();\n      } else {\n        mySound?.stop();\n        return playRandomSound(material);\n      }\n    });\n  });\n\n  const fields = \"abcdefghijklmnopqrstuvwxy\".split(\"\");\n\n  fields.forEach((field) => {\n    const nextFields = fields.filter((f) => f !== field);\n    nextFields.forEach((nextField) => {\n      const areaName = `${field}2${nextField}`;\n      WA.room.area.onEnter(areaName).subscribe(async () => {\n        const area = await WA.room.area.get(nextField);\n        if (area) {\n          const { x, y, width, height } = area;\n          const randomX = x + Math.random() * width;\n          const randomY = y + Math.random() * height;\n          WA.player.teleport(randomX, randomY);\n          console.log(`Player jumped from ${field} to ${nextField} at coordinates (${randomX}, ${randomY})`);\n        } else {\n          console.error(`Area ${nextField} not found`);\n        }\n      });\n    });\n  });\nlet jumpingJacksPopup: any;\nlet hasShownPopup = false;\n\n\nWA.room.area.onEnter('start_jumpingjack').subscribe( () => {\n  if (!hasShownPopup) {\n    jumpingJacksPopup = WA.ui.openPopup('popup_jumpingjacks', 'Welcome to the Jumping Jack Challenge!\\n In this game, you need to cross the map from the bottom right to the top left.\\nThe coins on the floor indicate how far you will jump when stepping on the directional arrows.\\nBe careful, the floor is lava \\n Good luck!', [{\n      label: 'Close',\n      className: 'primary',\n      callback: (popup) => {\n        // Close the popup when the \"Close\" button is pressed.\n        popup.close();\n      }\n    }]);\n    hasShownPopup = true;\n  }\n});\nWA.room.area.onLeave('start_jumpingjack').subscribe( () => {\n  if (jumpingJacksPopup) {\n    jumpingJacksPopup.close();\n  }\n});\nWA.room.area.onEnter('y2x').subscribe(async () => {\n  await new Promise(resolve => setTimeout(resolve, 500)); // Wait for half a second\n  WA.controls.disableWheelZoom();\n  const playerPosition = await WA.player.getPosition();\n  WA.camera.set(playerPosition.x, playerPosition.y, 300, 300, false, true);\n  });\nlet jumpCount = 0;\nWA.room.area.onEnter('x').subscribe(async () => {\nWA.ui.actionBar.addButton({\n  id: 'reset',\n  type: 'action',\n  imageSrc: 'https://minio-production-fa1d.up.railway.app/typebot/public/workspaces/clwxv3blz001hp28kvtibhtth/typebots/cm0v10et3000ahfv7f1qc2wju/blocks/xjb2tkpg6p8vz8rgfbf0wfxe?v=1729075857883',\n  toolTip: 'return to start',\n  callback: async () => {\n    const area = await WA.room.area.get('y');\n    if (area) {\n      const { x, y, width, height } = area;\n      const randomX = x + Math.random() * width;\n      const randomY = y + Math.random() * height;\n      WA.player.teleport(randomX, randomY);\n      console.log(`Player teleported back to area 'y' at coordinates (${randomX}, ${randomY})`);\n    } else {\n      console.error(`Area 'y' not found`);\n    }\n  }\n})})\nfields.forEach((field) => {\n  const nextFields = fields.filter((f) => f !== field);\n  nextFields.forEach((nextField) => {\n    const areaName = `${field}2${nextField}`;\n    WA.room.area.onEnter(areaName).subscribe(async () => {\n      const area = await WA.room.area.get(nextField);\n      if (area) {\n        const { x, y, width, height } = area;\n        const randomX = x + Math.random() * width;\n        const randomY = y + Math.random() * height;\n        WA.player.teleport(randomX, randomY);\n        jumpCount++;\n        console.log(`Player jumped from ${field} to ${nextField} at coordinates (${randomX}, ${randomY}). Jump count: ${jumpCount}`);\n      } else {\n        console.error(`Area ${nextField} not found`);\n      }\n    });\n  });\n});\nWA.room.area.onEnter('jumping_finish').subscribe(async () => {\n  const hasSolved = WA.player.state.hasSolved;\n  if (hasSolved) {\n    console.log('Player has already solved the Jumping Jack Challenge. No EXP awarded.');\n    return;\n  }\n\n  let exp = 0;\n  if (jumpCount <= 8) {\n    exp = 1519;\n  } else {\n    const excessJumps = jumpCount - 8;\n    exp = Math.max(0, 1519 * (1 - (excessJumps / 100))); // Reduce EXP in percentage relation\n  }\n\n  levelUp(\"JUMPING\", exp);\n  console.log(`Player finished the Jumping Jack Challenge with ${jumpCount} jumps and earned ${exp} EXP`);\n\n  await WA.player.state.saveVariable('hasSolved', true, { persist: true, scope: \"world\" }); // Set the persistent variable\n  jumpCount = 0; // Reset jump count for next game\n});\n\nWA.room.area.onEnter('jumping_finish').subscribe(() => {\n \n    jumpingJacksPopup = WA.ui.openPopup('popup_jumpingjacks', 'Congratulations, you solved the puzzle. \\n Check out the Leaderboard to see who else solved the puzzle. \\n Click on the logo on the bottom to open the menu and navigate to \"Quests\" \\n\\nLeave the puzzle by entering the mouth next to you.', [{\n      label: 'close',\n      className: 'primary',\n      callback: (popup) => {\n        // Close the popup when the \"Close\" button is pressed.\n        popup.close();\n      }\n    }]);\n    hasShownPopup = true;\n  \n});\nWA.onInit().then(() => {\nWA.room.area.onEnter('exit1').subscribe( () => {WA.nav.goToRoom(\"/\")});\n\nWA.room.area.onEnter('exit2').subscribe( () => {WA.nav.goToRoom(\"/\")});\n})"],"names":["lavaSFX","config","subscribeToLLMAreas","bootstrapExtra","e","x","y","moving","material","checkPlayerMaterial","_b","mySound","_c","playRandomSound","_a","fields","field","f","nextField","areaName","area","width","height","randomX","randomY","jumpingJacksPopup","hasShownPopup","popup","resolve","playerPosition","jumpCount","exp","excessJumps","levelUp"],"mappings":"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"}